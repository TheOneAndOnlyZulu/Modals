import{filterXSS as t}from'xss';class e{constructor(){this.focusableEl='a[href]:not([disabled]), button:not([disabled]), textarea:not([disabled]), input[type="text"]:not([disabled]), input[type="radio"]:not([disabled]), input[type="checkbox"]:not([disabled]), select:not([disabled])',this.willAnim=!1,this.animTime=300,this.initiatorButton=null,this.allowedAttr=['aria-label','id','class','title'],this.btns=[{type:'button',text:'Cancel',attr:{'aria-label':'Close modal',id:'ssm-modal__na',class:'btn',title:'Close modal'}},{type:'button',text:'Accept',attr:{'aria-label':'Close modal',id:'ssm-modal__pa',class:'btn',title:'Accept & close modal'}}],this.removeIcon='<svg id="ssm-remove-icon" class="ssm-modal-remove" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path id="ssm-remove-icon-path" fill="#fff" d="M193.94 256L296.5 153.44l21.15-21.15c3.12-3.12 3.12-8.19 0-11.31l-22.63-22.63c-3.12-3.12-8.19-3.12-11.31 0L160 222.06 36.29 98.34c-3.12-3.12-8.19-3.12-11.31 0L2.34 120.97c-3.12 3.12-3.12 8.19 0 11.31L126.06 256 2.34 379.71c-3.12 3.12-3.12 8.19 0 11.31l22.63 22.63c3.12 3.12 8.19 3.12 11.31 0L160 289.94 262.56 392.5l21.15 21.15c3.12 3.12 8.19 3.12 11.31 0l22.63-22.63c3.12-3.12 3.12-8.19 0-11.31L193.94 256z"/></svg>'}strip(t){try{var e=document.implementation.createDocument('http://www.w3.org/1999/xhtml','html',null);return e.documentElement.innerHTML=t,e.documentElement.textContent||e.documentElement.innerText}catch(t){return''}}async remove(){const t=document.getElementById('ssm-modal');t&&(!0===this.willAnim&&(t.setAttribute('aria-hidden',!0),await new Promise((t=>setTimeout(t,this.animTime)))),t.remove()),null!==this.initiatorButton&&this.initiatorButton.focus()}generate({title:e='',description:n='',mainContent:i='',callback:s=null,params:o={},initiatorButton:a=null,willAnimate:l=this.willAnim,animationTimeout:d=this.animTime,buttons:m=this.btns}){a&&(this.initiatorButton=a,o.initiatorButton=a),d&&(this.animTime=d),l&&(this.willAnim=l);const c=i?`<div id="content" class="ssm-modal__content">${t(i)}</div>`:'',r=n?`<div id="ssm-modal__description"><p>${this.strip(n)}</p></div>`:'';m=this.constructBtns(m);const u=`\n\t\t<div\n\t\t\tid="ssm-modal"\n\t\t\tclass="ssm-modal${l?' will-animate':''}"\n\t\t\trole="dialog"\n\t\t\taria-modal="true"\n\t\t\taria-labelledby="ssm-modal__title"\n    \t\taria-describedby="ssm-modal__description"\n\t\t\taria-hidden="false"\n\t\t>\n            ${this.removeIcon}\n\n\t\t\t<div class="ssm-modal__container">\n\t\t\t\t${e?`<h3 id="ssm-modal__title">${this.strip(e)}</h3>`:''}\n\n\t\t\t\t${r}\n\n\t\t\t\t${c}\n\n\t\t\t\t${m&&`<div class="ssm-modal-buttons is-flex">${t(m)}</div>`}\n\t\t\t</div>\n\t\t</div>`;document.body.insertAdjacentHTML('beforeend',u),this.initiateFocusTrap('ssm-modal'),document.getElementById('ssm-modal__na')&&document.getElementById('ssm-modal__na').addEventListener('click',(()=>this.remove())),document.getElementById('ssm-modal').addEventListener('click',(t=>{['ssm-modal','ssm-remove-icon','ssm-remove-icon-path'].includes(t.target.getAttribute('id'))&&this.remove()})),document.body.addEventListener('keydown',(t=>{const e=t||window.event;('key'in e?'Escape'===e.key||'Esc'===e.key:27===e.keyCode)&&this.remove()})),s&&document.getElementById('ssm-modal__pa').addEventListener('click',(()=>{s(o)}))}constructBtns(t=[]){let e='';return t.forEach((t=>{const n='button'===t.type?'button':'a';let i='';Object.entries(t.attr).map((([t,e])=>{this.allowedAttr.includes(t)&&(i+=` ${t}="${this.strip(e)}"`)}));const s=`<${n} ${i}>${t.text}</${n}>`;e+=s})),e}initiateFocusTrap(t){const e=document.querySelector('#'+t),n=e.querySelectorAll(this.focusableEl),i=n[0],s=n[n.length-1];i&&i.focus(),e.addEventListener('keydown',(t=>{'Tab'!==t.key&&9!==t.keyCode||(t.shiftKey?document.activeElement===i&&(s.focus(),t.preventDefault()):document.activeElement===s&&(i.focus(),t.preventDefault()))}))}}export{e as default};
